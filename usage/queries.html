<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Queries &mdash; Veritas  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Custom Trees" href="custom_trees.html" />
    <link rel="prev" title="Trees Ensembles" href="tree_ensembles.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Veritas
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tree_ensembles.html">Trees Ensembles</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-the-global-maximum-of-the-ensemble">Finding the Global Maximum of the Ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constrained-minimization">Constrained Minimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contrasting-two-instances">Contrasting Two Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-robustness">Checking Robustness</a></li>
<li class="toctree-l2"><a class="reference internal" href="#one-hot-constraint">One-hot constraint</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom_trees.html">Custom Trees</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/python/python.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/python/model_conversion.html">Model Conversion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cpp/cpp.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Veritas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Queries</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/queries.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="queries">
<h1>Queries<a class="headerlink" href="#queries" title="Link to this heading"></a></h1>
<p>First, we will train a model on a small dataset and get the corresponding AddTree.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>AddTree<span class="w"> </span>with<span class="w"> </span><span class="m">2</span><span class="w"> </span>trees<span class="w"> </span>and<span class="w"> </span>base_scores<span class="w"> </span><span class="o">[</span><span class="m">0</span><span class="o">]</span>

Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">2</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">1</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">3</span><span class="o">])</span>
│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">4</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">4</span><span class="o">])</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">3</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">6</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">5</span><span class="o">])</span>
│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">6</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">6</span><span class="o">])</span>

Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">3</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">5</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">30</span><span class="o">])</span>
│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">4</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">40</span><span class="o">])</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">6</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">50</span><span class="o">])</span>
│<span class="w">  </span>├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">6</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F2<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>.5<span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">8</span><span class="o">)</span>
│<span class="w">  </span>│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">70</span><span class="o">])</span>
│<span class="w">  </span>│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">80</span><span class="o">])</span>
</pre></div>
</div>
</div>
<section id="finding-the-global-maximum-of-the-ensemble">
<h2>Finding the Global Maximum of the Ensemble<a class="headerlink" href="#finding-the-global-maximum-of-the-ensemble" title="Link to this heading"></a></h2>
<p>We can use Veritas to find the feature values for which the model’s output is maximal as follows.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># What is the maximum of the ensemble?</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">veritas</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MAX_OUTPUT</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at</span><span class="p">,{})</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Global maximum&quot;</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">11</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- current best solution:&quot;</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span>
<span class="linenos">12</span>          <span class="s2">&quot;optimal&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_optimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;suboptimal&quot;</span><span class="p">,</span> <span class="s2">&quot;solution&quot;</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- feature value ranges&quot;</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">())</span>
<span class="linenos">14</span>    <span class="n">sol_nodes</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution_nodes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">15</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  which lead to leaf nodes&quot;</span><span class="p">,</span> <span class="n">sol_nodes</span><span class="p">,</span>
<span class="linenos">16</span>          <span class="s2">&quot;with leaf values&quot;</span><span class="p">,</span>
<span class="linenos">17</span>          <span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_leaf_value</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sol_nodes</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Global<span class="w"> </span>maximum
-<span class="w"> </span>current<span class="w"> </span>best<span class="w"> </span>solution:<span class="w"> </span><span class="m">86</span>.0<span class="w"> </span>-&gt;<span class="w"> </span>optimal<span class="w"> </span>solution
-<span class="w"> </span>feature<span class="w"> </span>value<span class="w"> </span>ranges<span class="w"> </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)}</span>
<span class="w">  </span>which<span class="w"> </span>lead<span class="w"> </span>to<span class="w"> </span>leaf<span class="w"> </span>nodes<span class="w"> </span><span class="o">[</span><span class="m">6</span>,<span class="w"> </span><span class="m">8</span><span class="o">]</span><span class="w"> </span>with<span class="w"> </span>leaf<span class="w"> </span>values<span class="w"> </span><span class="o">[</span><span class="m">6</span>.0,<span class="w"> </span><span class="m">80</span>.0<span class="o">]</span>
</pre></div>
</div>
</div>
<p>The solutions generated by <code class="docutils literal notranslate"><span class="pre">Search</span></code> are accessible using <code class="docutils literal notranslate"><span class="pre">get_solution</span></code>. The solutions are sorted descendingly: the best solution is at index 0, the worst solution is at index <code class="docutils literal notranslate"><span class="pre">s.num_solutions()-1</span></code>.</p>
<p>A best solution at index 0 is optimal when <code class="docutils literal notranslate"><span class="pre">s.is_optimal()</span></code> returns true. To know when the solution was generated, <code class="docutils literal notranslate"><span class="pre">sol.time</span></code> contains the number of seconds since the construction of the <code class="docutils literal notranslate"><span class="pre">Search</span></code> object.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sol.box()</span></code> method returns the value intervals of the features for which the output of the ensemble is unchanged. That is, for each possible assignment within the intervals, the trees always evaluate to the same leaf node (<code class="docutils literal notranslate"><span class="pre">s.get_solution_nodes</span></code>), and thus to the same output value. If a feature is missing from the box, it means that its value does not make a difference.</p>
</section>
<section id="constrained-minimization">
<h2>Constrained Minimization<a class="headerlink" href="#constrained-minimization" title="Link to this heading"></a></h2>
<p>In this example, we constrain the first feature value to be between 3 and 5.
Because this is a very simple constraint, we can simply prune the search space before we start the search.</p>
<p>Although the constraint is simple, it is very useful. The exact same pruning strategy is used for l-infinity robustenss checking.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># If feature0 is between 3 and 5, what is the minimum possible output?</span>
<span class="linenos"> 2</span><span class="n">prune_box</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Interval</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))]</span>  <span class="c1"># (feat_id, domain) list, sorted by feat_id</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MIN_OUTPUT</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">prune_box</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum with feature0 in [3, 5]&quot;</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">12</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- current best solution:&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span>
<span class="linenos">13</span>          <span class="s2">&quot;optimal&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_optimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;suboptimal&quot;</span><span class="p">,</span> <span class="s2">&quot;solution&quot;</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- feature value ranges&quot;</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">())</span>
<span class="linenos">15</span>    <span class="n">sol_nodes</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution_nodes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">16</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  which lead to leaf nodes&quot;</span><span class="p">,</span> <span class="n">sol_nodes</span><span class="p">,</span>
<span class="linenos">17</span>          <span class="s2">&quot;with leaf values&quot;</span><span class="p">,</span>
<span class="linenos">18</span>          <span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_leaf_value</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sol_nodes</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Minimum<span class="w"> </span>with<span class="w"> </span>feature0<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span><span class="m">3</span>,<span class="w"> </span><span class="m">5</span><span class="o">]</span>
-<span class="w"> </span>current<span class="w"> </span>best<span class="w"> </span>solution:<span class="w"> </span>-56.0<span class="w"> </span>-&gt;<span class="w"> </span>optimal<span class="w"> </span>solution
-<span class="w"> </span>feature<span class="w"> </span>value<span class="w"> </span>ranges<span class="w"> </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span><span class="m">3</span>,5<span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&lt;<span class="m">0</span><span class="o">)}</span>
<span class="w">  </span>which<span class="w"> </span>lead<span class="w"> </span>to<span class="w"> </span>leaf<span class="w"> </span>nodes<span class="w"> </span><span class="o">[</span><span class="m">6</span>,<span class="w"> </span><span class="m">5</span><span class="o">]</span><span class="w"> </span>with<span class="w"> </span>leaf<span class="w"> </span>values<span class="w"> </span><span class="o">[</span><span class="m">6</span>.0,<span class="w"> </span><span class="m">50</span>.0<span class="o">]</span>
</pre></div>
</div>
</div>
<p>We minimize by maximizing the negated ensemble, i.e., the ensemble where all leaf values are negated.</p>
<p>The pruning simply removes all leaf nodes with boxes that do not overlap with <code class="docutils literal notranslate"><span class="pre">prune_box</span></code> from the search.</p>
</section>
<section id="contrasting-two-instances">
<h2>Contrasting Two Instances<a class="headerlink" href="#contrasting-two-instances" title="Link to this heading"></a></h2>
<p>In this example, we want to know what the maximum difference between the outputs of two instances can be when only the third feature is different, and first and second feature values are the same.</p>
<p>We achieve this by renaming the feature IDs in one of the trees using a feature map or <code class="docutils literal notranslate"><span class="pre">FeatMap</span></code> object.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># For two instances X0 and X1, allowing only feature3 to be different between</span>
<span class="linenos"> 2</span><span class="c1"># the two instances, what is the maximum output difference at(X1)-at(X0)?</span>
<span class="linenos"> 3</span><span class="n">feat_map</span> <span class="o">=</span> <span class="n">FeatMap</span><span class="p">([</span><span class="s2">&quot;feature1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature2&quot;</span><span class="p">,</span> <span class="s2">&quot;feature3&quot;</span><span class="p">])</span>
<span class="linenos"> 4</span><span class="n">feat_map</span><span class="o">.</span><span class="n">use_same_id_for</span><span class="p">(</span><span class="n">feat_map</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s2">&quot;feature1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 5</span>                         <span class="n">feat_map</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s2">&quot;feature1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 6</span><span class="n">feat_map</span><span class="o">.</span><span class="n">use_same_id_for</span><span class="p">(</span><span class="n">feat_map</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s2">&quot;feature2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 7</span>                         <span class="n">feat_map</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s2">&quot;feature2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1"># `at_renamed` will use a different id for feature3, but the same id for</span>
<span class="linenos">10</span><span class="c1"># feature0 and feature1</span>
<span class="linenos">11</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;feat_id used for feature3 for instances:&quot;</span><span class="p">,</span>
<span class="linenos">12</span>        <span class="n">feat_map</span><span class="o">.</span><span class="n">get_feat_id</span><span class="p">(</span><span class="s2">&quot;feature3&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos">13</span>        <span class="n">feat_map</span><span class="o">.</span><span class="n">get_feat_id</span><span class="p">(</span><span class="s2">&quot;feature3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">14</span><span class="n">at_contrast</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">concat_negated</span><span class="p">(</span><span class="n">feat_map</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="nb">print</span><span class="p">()</span>
<span class="linenos">17</span><span class="nb">print</span><span class="p">(</span><span class="n">at_contrast</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">18</span><span class="nb">print</span><span class="p">(</span><span class="n">at_contrast</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>feat_id<span class="w"> </span>used<span class="w"> </span><span class="k">for</span><span class="w"> </span>feature3<span class="w"> </span><span class="k">for</span><span class="w"> </span>instances:<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span>

Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">3</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">5</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">30</span><span class="o">])</span>
│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">4</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">40</span><span class="o">])</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">6</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">50</span><span class="o">])</span>
│<span class="w">  </span>├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">6</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F2<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>.5<span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">8</span><span class="o">)</span>
│<span class="w">  </span>│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">70</span><span class="o">])</span>
│<span class="w">  </span>│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">80</span><span class="o">])</span>

Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">3</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">5</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-30<span class="o">])</span>
│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">4</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-40<span class="o">])</span>
├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span><span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">6</span><span class="o">)</span>
│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">5</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-50<span class="o">])</span>
│<span class="w">  </span>├─<span class="w"> </span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">6</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F5<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>.5<span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">8</span><span class="o">)</span>
│<span class="w">  </span>│<span class="w">  </span>├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">7</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-70<span class="o">])</span>
│<span class="w">  </span>│<span class="w">  </span>└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-80<span class="o">])</span>
</pre></div>
</div>
</div>
<p>There are two differences between tree 1 and tree 3:</p>
<ul class="simple">
<li><p>the leaf values are negated (<code class="docutils literal notranslate"><span class="pre">concat_negated</span></code>)</p></li>
<li><p>internal node 6 uses feature ID 2 in tree 1 and feature ID 5 in tree 3</p></li>
</ul>
<p>The other feature IDs are the same. This has the effect of allowing the first two trees (corresponding to the first instance) to take on different values for feature 3 than the last two trees (corresponding to the second instance).</p>
<p>The renaming of the feature IDs is fascilitated by the <code class="docutils literal notranslate"><span class="pre">FeatMap</span></code> object.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">print</span><span class="p">(</span><span class="n">feat_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>FeatMap<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature1<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="w">    </span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature2<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="w">    </span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature3<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="w">    </span><span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature1<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature2<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="o">[</span><span class="m">5</span><span class="o">]</span><span class="w"> </span><span class="sb">`</span>feature3<span class="sb">`</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">(</span>instance<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>The above gives all IDs used by the two instances. <code class="docutils literal notranslate"><span class="pre">FeatMap::share_all_features_between_instances</span></code> can be used share all feature values between the two intances. By default, each ID is unique.
Use <code class="docutils literal notranslate"><span class="pre">FeatMap::use_same_id_for</span></code> to share the same ID for two features, either between two instances, or for the same instance.
Use <code class="docutils literal notranslate"><span class="pre">FeatMap::transform</span></code> to apply the changes to an <code class="docutils literal notranslate"><span class="pre">AddTree</span></code>.</p>
<p>We can find the maximum difference between the outputs of the first and the second instance as follows:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MAX_OUTPUT</span><span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at_contrast</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">s</span><span class="o">.</span><span class="n">step_for</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum difference between instance0 and instance1&quot;</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- current best solution:&quot;</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span>
<span class="linenos">11</span>          <span class="s2">&quot;optimal&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_optimal</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;suboptimal&quot;</span><span class="p">,</span> <span class="s2">&quot;solution&quot;</span><span class="p">)</span>
<span class="linenos">12</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- feature value ranges&quot;</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">())</span>
<span class="linenos">13</span>    <span class="n">sol_nodes</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution_nodes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  which lead to leaf nodes&quot;</span><span class="p">,</span> <span class="n">sol_nodes</span><span class="p">,</span>
<span class="linenos">15</span>          <span class="s2">&quot;with leaf values&quot;</span><span class="p">,</span>
<span class="linenos">16</span>          <span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_leaf_value</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sol_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])],</span>
<span class="linenos">17</span>          <span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_leaf_value</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sol_nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])])</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Maximum<span class="w"> </span>difference<span class="w"> </span>between<span class="w"> </span>instance0<span class="w"> </span>and<span class="w"> </span>instance1
-<span class="w"> </span>current<span class="w"> </span>best<span class="w"> </span>solution:<span class="w"> </span><span class="m">10</span>.0<span class="w"> </span>-&gt;<span class="w"> </span>optimal<span class="w"> </span>solution
-<span class="w"> </span>feature<span class="w"> </span>value<span class="w"> </span>ranges<span class="w"> </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)</span>,<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Interval<span class="o">(</span>&lt;<span class="m">0</span>.5<span class="o">)}</span>
<span class="w">  </span>which<span class="w"> </span>lead<span class="w"> </span>to<span class="w"> </span>leaf<span class="w"> </span>nodes<span class="w"> </span><span class="o">[</span><span class="m">6</span>,<span class="w"> </span><span class="m">8</span>,<span class="w"> </span><span class="m">6</span>,<span class="w"> </span><span class="m">7</span><span class="o">]</span><span class="w"> </span>with<span class="w"> </span>leaf<span class="w"> </span>values<span class="w"> </span><span class="o">[</span><span class="m">6</span>.0,<span class="w"> </span><span class="m">80</span>.0<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">6</span>.0,<span class="w"> </span><span class="m">70</span>.0<span class="o">]</span>
</pre></div>
</div>
</div>
<p>The maximum output difference in this case is 10. The only possible variation is between leaf nodes 7 or 8 in the second tree.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">Search::step_for(duration_in_seconds,</span> <span class="pre">num_steps)</span></code> to let the search run for the given duration. Per <code class="docutils literal notranslate"><span class="pre">num_steps</span></code> steps, a snapshot is added to <code class="docutils literal notranslate"><span class="pre">Search::snapshots</span></code>. This can be used to track the following stats:</p>
<ul class="simple">
<li><p>time (<code class="docutils literal notranslate"><span class="pre">time</span></code>)</p></li>
<li><p>number of steps executed so far (<code class="docutils literal notranslate"><span class="pre">num_steps</span></code>)</p></li>
<li><p>number of solutions so far (<code class="docutils literal notranslate"><span class="pre">num_solutions</span></code>)</p></li>
<li><p>number of search states expanded so far (<code class="docutils literal notranslate"><span class="pre">num_states</span></code>)</p></li>
<li><p>best epsilon value (<code class="docutils literal notranslate"><span class="pre">eps</span></code>)</p></li>
<li><p>the best bounds so far (<code class="docutils literal notranslate"><span class="pre">bounds</span></code>), a tuple containing lower bound, A* upper bound, and ARA* upper bound</p></li>
</ul>
</section>
<section id="checking-robustness">
<h2>Checking Robustness<a class="headerlink" href="#checking-robustness" title="Link to this heading"></a></h2>
<p>Before we check the robustness of a particular example, we’ll first use Veritas to enumerate all possible output configurations of the additive tree ensemble. To do this, we simply run the search until <code class="docutils literal notranslate"><span class="pre">Search::steps</span></code> returns false, indicating that all search states have been visited.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Checking robustness</span>
<span class="linenos"> 2</span><span class="c1"># We change the `base_score` of the ensemble so that we can have negative</span>
<span class="linenos"> 3</span><span class="c1"># outputs, which is necessary for robustness checking (we want classes to</span>
<span class="linenos"> 4</span><span class="c1"># flip!)</span>
<span class="linenos"> 5</span><span class="n">at</span><span class="o">.</span><span class="n">set_base_score</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">44</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1"># Generate all possible output configurations for this `at`</span>
<span class="linenos"> 8</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MAX_OUTPUT</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">done</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos">12</span><span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="n">done</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;3}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">))</span>
<span class="linenos">16</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()):</span>
<span class="linenos">17</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>i<span class="w">   </span>output<span class="w">     </span>box
<span class="m">0</span><span class="w">   </span><span class="m">42</span>.0<span class="w">       </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)}</span>
</pre></div>
</div>
</div>
<p>The boxes above partition the input space. Remember that when a feature is not present in a box, it does not have an effect given the other feature values and can take on any value.</p>
<p>We will pick an example from box 6 with output -9:</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">example</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output for example&quot;</span><span class="p">,</span> <span class="n">example</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">example</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>output<span class="w"> </span><span class="k">for</span><span class="w"> </span>example<span class="w"> </span><span class="o">[</span><span class="m">2</span>,<span class="w"> </span><span class="m">4</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>is<span class="w"> </span><span class="o">[</span>-9.<span class="o">]</span>
</pre></div>
</div>
</div>
<p>We now try to find the distance to the closest adversarial example for which the output of the model is positive. We use <code class="docutils literal notranslate"><span class="pre">VeritasRobustnessSearch</span></code> for this. The arguments are:</p>
<ul class="simple">
<li><p>model to minimize or None</p></li>
<li><p>model to maximize or None (use both for targeted attacks)</p></li>
<li><p>the example</p></li>
<li><p>the initial delta value used by the binary search</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id16" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">veritas</span> <span class="kn">import</span> <span class="n">VeritasRobustnessSearch</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">rob</span> <span class="o">=</span> <span class="n">VeritasRobustnessSearch</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="n">example</span><span class="p">,</span> <span class="n">start_delta</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">delta</span><span class="p">,</span> <span class="n">delta_lo</span><span class="p">,</span> <span class="n">delta_up</span> <span class="o">=</span> <span class="n">rob</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
<span class="linenos">5</span>
<span class="linenos">6</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adversarial examples:&quot;</span><span class="p">,</span> <span class="n">rob</span><span class="o">.</span><span class="n">generated_examples</span><span class="p">,</span>
<span class="linenos">7</span>        <span class="s2">&quot;with outputs&quot;</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rob</span><span class="o">.</span><span class="n">generated_examples</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id17" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">0</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w">   </span>SAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">5</span>.00000<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.50000<span class="w"> </span><span class="o">[</span><span class="m">0</span>.00000,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span><span class="w"> </span><span class="o">(</span>!<span class="o">)</span><span class="w"> </span>ex.w/<span class="w"> </span>delta<span class="w"> </span><span class="m">1</span>.0000
<span class="o">[</span><span class="m">1</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.50000<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.75000<span class="w"> </span><span class="o">[</span><span class="m">0</span>.50000,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">2</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.75000<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.87500<span class="w"> </span><span class="o">[</span><span class="m">0</span>.75000,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">3</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.87500<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.93750<span class="w"> </span><span class="o">[</span><span class="m">0</span>.87500,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">4</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.93750<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.96875<span class="w"> </span><span class="o">[</span><span class="m">0</span>.93750,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">5</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.96875<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.98438<span class="w"> </span><span class="o">[</span><span class="m">0</span>.96875,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">6</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.98438<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.99219<span class="w"> </span><span class="o">[</span><span class="m">0</span>.98438,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">7</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.99219<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.99609<span class="w"> </span><span class="o">[</span><span class="m">0</span>.99219,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">8</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.99609<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.99805<span class="w"> </span><span class="o">[</span><span class="m">0</span>.99609,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
<span class="o">[</span><span class="m">9</span><span class="w"> </span><span class="m">0</span>.0s<span class="o">]</span>:<span class="w"> </span>UNSAT<span class="w"> </span><span class="k">for</span><span class="w"> </span>delta<span class="w"> </span><span class="m">0</span>.99805<span class="w"> </span>-&gt;<span class="w"> </span><span class="m">0</span>.99902<span class="w"> </span><span class="o">[</span><span class="m">0</span>.99805,<span class="w"> </span><span class="m">1</span>.00000<span class="o">]</span>
adversarial<span class="w"> </span>examples:<span class="w"> </span><span class="o">[[</span><span class="m">3</span>.0,<span class="w"> </span><span class="m">4</span>,<span class="w"> </span><span class="m">2</span><span class="o">]]</span><span class="w"> </span>with<span class="w"> </span>outputs<span class="w"> </span><span class="o">[[</span><span class="m">42</span>.<span class="o">]]</span>
</pre></div>
</div>
</div>
<p>We can verify this result using the MILP approach (Kantchelian et al.’16):</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id18" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">veritas.kantchelian</span> <span class="kn">import</span> <span class="n">KantchelianAttack</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">kan</span> <span class="o">=</span> <span class="n">KantchelianAttack</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">target_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">example</span><span class="o">=</span><span class="n">example</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">kan</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
<span class="linenos">5</span><span class="n">adv_example</span><span class="p">,</span> <span class="n">adv_output</span> <span class="o">=</span> <span class="n">kan</span><span class="o">.</span><span class="n">solution</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
<span class="linenos">6</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kantchelian adversarial example&quot;</span><span class="p">,</span> <span class="n">adv_example</span><span class="p">,</span> <span class="s2">&quot;with output&quot;</span><span class="p">,</span> <span class="n">adv_output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id19" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Kantchelian<span class="w"> </span>adversarial<span class="w"> </span>example<span class="w"> </span><span class="o">[</span><span class="m">3</span>.0,<span class="w"> </span><span class="m">4</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>with<span class="w"> </span>output<span class="w"> </span><span class="m">42</span>.0
</pre></div>
</div>
</div>
<p>MILP indeed finds the same solution.</p>
</section>
<section id="one-hot-constraint">
<h2>One-hot constraint<a class="headerlink" href="#one-hot-constraint" title="Link to this heading"></a></h2>
<p>We can tell Veritas that some of the features are the results of a one-hot encoded categorical feature using <code class="docutils literal notranslate"><span class="pre">Search::add_onehot_constraint</span></code>. This ensures that exactly one of the features is true at all times.</p>
<p>For this constructed example with only two one-hot encoded features, the total number of solutions is four, but two of them are invalid:</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id20" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Constraints: one-hot (feature0 and feature1 cannot be true at the same time)</span>
<span class="linenos"> 2</span><span class="c1"># That is, the model below can only output 0: -100 + 100 and 100 - 100</span>
<span class="linenos"> 3</span><span class="n">at</span> <span class="o">=</span> <span class="n">AddTree</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="n">t</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">add_tree</span><span class="p">();</span>
<span class="linenos"> 5</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># Boolean split(node_id, feature_id, split_value)</span>
<span class="linenos"> 6</span><span class="n">t</span><span class="o">.</span><span class="n">set_leaf_value</span><span class="p">(</span> <span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">()),</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="n">t</span><span class="o">.</span><span class="n">set_leaf_value</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">()),</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">t</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">add_tree</span><span class="p">();</span>
<span class="linenos">10</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>   <span class="c1"># Boolean split(node_id, feature_id, split_value)</span>
<span class="linenos">11</span><span class="n">t</span><span class="o">.</span><span class="n">set_leaf_value</span><span class="p">(</span> <span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">()),</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">t</span><span class="o">.</span><span class="n">set_leaf_value</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">root</span><span class="p">()),</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="nb">print</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">15</span><span class="nb">print</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c1"># Without one-hot constraint: solution is incorrect feat0 == true &amp;&amp; feat1 ==</span>
<span class="linenos">18</span><span class="c1"># true leading to output of 200.</span>
<span class="linenos">19</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MAX_OUTPUT</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos">23</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Without one-hot constraint&quot;</span><span class="p">)</span>
<span class="linenos">24</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;3}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">))</span>
<span class="linenos">25</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()):</span>
<span class="linenos">26</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">27</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">28</span><span class="c1">#print(&quot;number of rejected states due to constraint:&quot;, s.num_rejected_states)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id21" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F0<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>.5<span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-100<span class="o">])</span>
└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">100</span><span class="o">])</span>

Node<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">split</span><span class="o">=[</span>F1<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>.5<span class="o">]</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">3</span>,<span class="w"> </span><span class="nv">left</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">right</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>
├─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span>-100<span class="o">])</span>
└─<span class="w"> </span>Leaf<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">sz</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">value</span><span class="o">=[</span><span class="m">100</span><span class="o">])</span>


Without<span class="w"> </span>one-hot<span class="w"> </span>constraint
i<span class="w">   </span>output<span class="w">     </span>box
<span class="m">0</span><span class="w">   </span><span class="m">200</span>.0<span class="w">      </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)}</span>
</pre></div>
</div>
</div>
<p>When we inform Veritas that exactly one of the two features must be true:</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">Python</span><a class="headerlink" href="#id22" title="Link to this code"></a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># With constraint:</span>
<span class="linenos"> 2</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">HeuristicType</span><span class="o">.</span><span class="n">MAX_OUTPUT</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="n">s</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_search</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="c1">#s.add_onehot_constraint([0, 1]) # TODO add again</span>
<span class="linenos"> 5</span><span class="n">s</span><span class="o">.</span><span class="n">steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With one-hot constraint&quot;</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;3}</span><span class="s2"> </span><span class="si">{:&lt;10}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;box&quot;</span><span class="p">))</span>
<span class="linenos"> 8</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">num_solutions</span><span class="p">()):</span>
<span class="linenos"> 9</span>    <span class="n">sol</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_solution</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">output</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">box</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">11</span><span class="c1">#print(&quot;number of rejected states due to constraint:&quot;, s.num_rejected_states)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id23" title="Link to this code"></a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>With<span class="w"> </span>one-hot<span class="w"> </span>constraint
i<span class="w">   </span>output<span class="w">     </span>box
<span class="m">0</span><span class="w">   </span><span class="m">200</span>.0<span class="w">      </span><span class="o">{</span><span class="m">0</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)</span>,<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Interval<span class="o">(</span>&gt;<span class="o">=</span><span class="m">0</span>.5<span class="o">)}</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tree_ensembles.html" class="btn btn-neutral float-left" title="Trees Ensembles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="custom_trees.html" class="btn btn-neutral float-right" title="Custom Trees" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Laurens Devos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>